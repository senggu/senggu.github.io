<!DOCTYPE html>
<html lang="en">
<head>
    <!-- 기존의 head 내용 -->
    <meta charset="UTF-8">
    <!-- 수정된 meta 태그 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strength Card Selection Game</title>
    <!-- 폰트 링크 -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
            color: #333;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            justify-content: center;
        }

        h1 {
            font-family: 'Roboto', sans-serif;
            font-size: 2em;
            color: #fff;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 2px 2px 2px rgba(0,0,0,0.6);
        }

        .card-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
            padding: 0 10px;
            align-items: center;
        }

        .card {
            width: 45vw;
            max-width: 240px;
            height: auto;
            aspect-ratio: 2 / 3;
            cursor: pointer;
            border-radius: 15px;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            overflow: hidden;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            box-sizing: border-box;
        }

        .card img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .card:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 20px rgba(0, 0, 0, 0.2);
        }

        #selected-card {
            text-align: center;
            font-size: 1.2em;
            margin-top: 20px;
            color: #fff;
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            border-radius: 10px;
            width: auto;
            margin-left: auto;
            margin-right: auto;
        }

        #selection-count {
            text-align: center;
            font-size: 1em;
            margin-top: 10px;
            color: #fff;
            background: rgba(0, 0, 0, 0.2);
            padding: 8px;
            border-radius: 10px;
            width: auto;
            margin-left: auto;
            margin-right: auto;
        }

        /* 오버레이 스타일 */
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(128, 128, 128, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            color: #fff;
            font-size: 2em;
            font-weight: bold;
            border-radius: 15px;
        }

        /* 가로 정렬: 화면이 넓을 때 카드를 가로로 배치 */
        @media (min-width: 600px) {
            .card-container {
                flex-direction: row;
            }
        }

        /* 세로 정렬: 화면이 좁을 때 카드가 세로로 배치 */
        @media (max-width: 600px) {
            h1 {
                font-size: 1.5em;
            }
            .card {
                width: 48%;
                max-width: none;
                margin-bottom: 4%;
            }
            .card-container {
                gap: 4%;
                justify-content: space-between;
                flex-direction: column;
            }
            #selected-card, #selection-count {
                font-size: 1em;
                padding: 8px;
            }
            .overlay {
                font-size: 1.5em;
            }
        }

        /* 추가된 스타일 */
        .input-group {
            margin-bottom: 15px;
            text-align: left;
            width: 100%;
            max-width: 300px;
        }

        .input-group label {
            display: block;
            font-size: 1em;
            color: #000000;
            margin-bottom: 5px;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 8px;
            border-radius: 5px;
            border: none;
            font-size: 1em;
        }

        .start-button {
            padding: 10px 20px;
            font-size: 1em;
            border-radius: 5px;
            border: none;
            background-color: #fff;
            color: #333;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .start-button:hover {
            background-color: #f0f0f0;
        }

        /* 이미지 스타일 추가 */
        .intro-image {
            max-width: 300px;
            width: 100%;
            border-radius: 15px;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }

        /* 큰 이미지를 위한 새로운 클래스 추가 */
        .stage-image {
            max-width: 600px;
            width: 100%;
            border-radius: 15px;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }

        /* 변경된 CSS */
        .slots-container, .cards-container {
            width: 100%;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }

        .slot {
            width: 45vw;
            max-width: 240px;
            height: auto;
            aspect-ratio: 2 / 3;
            border: 2px dashed #7a4614;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .slot.filled {
            border: none;
        }



    </style>
</head>
<body>
    <h1>나의 강점을 표현한 카드는 무엇인가요?</h1>
    <p id="selection-count">1단계 - 선택한 카드: 0/8</p>    
    <div class="card-container" id="card-container">
        <!-- Cards or form will be generated here -->
    </div>
    <p id="selected-card"></p>

    
    <script>
        const images = [
            '감사1', '겸손1', '공정1', '리더쉽1', '사랑1', '사회성1', '신중1', '심미안1', '열정1', '영성1',
            '용감1', '용서와 자비1', '유머1', '인내1', '자기조절1', '정직1', '창의1', '친절1', '통찰1', '판단1',
            '학구열1', '협동1', '호기심1', '희망1'
        ];

        let nickname = '';
        let gender = '';
        let age = '';

        let usedImages = [];
        let displayedImages = [];
        let finalSelection = [];
        let selectedSlots = [];
        let stage = 0;

        function createCardElement(imageSrc, altText, onClick) {
            const cardElement = document.createElement('div');
            cardElement.className = 'card';
            if (onClick) {
                cardElement.onclick = onClick;
            }
            const imgElement = document.createElement('img');
            imgElement.src = imageSrc;
            imgElement.alt = altText;
            cardElement.appendChild(imgElement);
            return cardElement;
        }

        function getRandomCards(array, num, excludeImages = []) {
            const availableImages = array.filter(image => !excludeImages.includes(image) && !displayedImages.includes(image));
            const shuffled = [...availableImages].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, num);
        }

        function displayCards() {
            const cardContainer = document.getElementById('card-container');
            cardContainer.innerHTML = '';
            const heading = document.querySelector('h1');

            if (stage === 0) {
                displayInitialForm();
                return;
            } else if (stage === 1) {
                displayImage('images/stage1.png', '첫 번째 카드 선택 단계로 진행합니다.', 2);
                return;
            } else if (stage === 2) {
                heading.innerText = '나의 강점을 표현한 카드는 무엇인가요?';
                document.getElementById('selection-count').style.display = 'block';
                document.getElementById('selected-card').style.display = 'block';
                let selectedImages = getRandomCards(images, 3, usedImages);
                if (selectedImages.length === 0) {
                    return;
                }
                selectedImages.forEach((image, index) => {
                    const cardElement = createCardElement(`images/${image}.png`, `Card ${index + 1}`, () => selectCard(image));
                    cardContainer.appendChild(cardElement);
                    displayedImages.push(image);
                });
                updateSelectionCount();
            } else if (stage === 3) {
                displayImage('images/stage2.png', '두 번째 카드 선택 단계로 진행합니다.', 4);
                return;
            } else if (stage === 4) {
                heading.innerText = '나의 강점을 더욱 좁혀봅시다!';
                document.getElementById('selection-count').style.display = 'block';
                document.getElementById('selected-card').style.display = 'block';
                let selectedImages = getRandomCards(usedImages, 2, finalSelection);
                if (selectedImages.length === 0) {
                    return;
                }
                selectedImages.forEach((image, index) => {
                    const cardElement = createCardElement(`images/${image}.png`, `Card ${index + 1}`, () => selectCard(image));
                    cardContainer.appendChild(cardElement);
                    displayedImages.push(image);
                });
                updateSelectionCount();
            } else if (stage === 5) {
                displayImage('images/stage3.png', '카드 선택 단계로 진행합니다.', 6);
                return;
            } else if (stage === 6) {
                heading.innerText = '이 중에 삶에서 의미있다고 생각하는 것은 무엇입니까?\n (카드2장을 드래그하여 선택해주세요)';
                displayDragAndDropSelection();
                updateSelectionCount();
                return;
            } else if (stage === 7) {
                heading.innerText = '선택한 카드를 클릭하여 뒷면을 확인하세요.';
                displayFinalCards();
                updateSelectionCount();
                return;
            }
        }

        function displayImage(imageSrc, message, nextStage) {
            const cardContainer = document.getElementById('card-container');
            cardContainer.innerHTML = '';

            document.getElementById('selection-count').style.display = 'none';
            document.getElementById('selected-card').style.display = 'none';

            const imageElement = document.createElement('img');
            imageElement.src = imageSrc;
            imageElement.alt = 'Stage Image';
            imageElement.className = 'stage-image';

            const nextButton = document.createElement('button');
            nextButton.className = 'start-button';
            nextButton.innerText = '다음으로';
            nextButton.onclick = () => {
                stage = nextStage;
                displayCards();
            };

            cardContainer.appendChild(imageElement);

            if (message) {
                const messageElement = document.createElement('p');
                messageElement.innerText = message;
                messageElement.style.color = '#fff';
                messageElement.style.textAlign = 'center';
                cardContainer.appendChild(messageElement);
            }

            cardContainer.appendChild(nextButton);
        }

        function displayInitialForm() {
            // 기존 코드 유지
            // ...
            const heading = document.querySelector('h1');
            heading.innerText = '닉네임, 성별, 나이를 입력해주세요.';

            document.getElementById('selection-count').style.display = 'none';
            document.getElementById('selected-card').style.display = 'none';

            const cardContainer = document.getElementById('card-container');
            cardContainer.innerHTML = '';

            const introImage = document.createElement('img');
            introImage.src = 'images/intro.png';
            introImage.alt = 'Intro Image';
            introImage.className = 'intro-image';
            cardContainer.appendChild(introImage);

            // 입력 폼 생성
            const form = document.createElement('div');

            const nicknameGroup = document.createElement('div');
            nicknameGroup.className = 'input-group';
            const nicknameLabel = document.createElement('label');
            nicknameLabel.innerText = '닉네임:';
            const nicknameInput = document.createElement('input');
            nicknameInput.type = 'text';
            nicknameGroup.appendChild(nicknameLabel);
            nicknameGroup.appendChild(nicknameInput);

            const genderGroup = document.createElement('div');
            genderGroup.className = 'input-group';
            const genderLabel = document.createElement('label');
            genderLabel.innerText = '성별:';
            const genderSelect = document.createElement('select');
            const optionMale = document.createElement('option');
            optionMale.value = '남성';
            optionMale.innerText = '남성';
            const optionFemale = document.createElement('option');
            optionFemale.value = '여성';
            optionFemale.innerText = '여성';
            const optionOther = document.createElement('option');
            optionOther.value = '기타';
            optionOther.innerText = '기타';
            genderSelect.appendChild(optionMale);
            genderSelect.appendChild(optionFemale);
            genderSelect.appendChild(optionOther);
            genderGroup.appendChild(genderLabel);
            genderGroup.appendChild(genderSelect);

            const ageGroup = document.createElement('div');
            ageGroup.className = 'input-group';
            const ageLabel = document.createElement('label');
            ageLabel.innerText = '나이:';
            const ageInput = document.createElement('input');
            ageInput.type = 'number';
            ageInput.min = '0';
            ageGroup.appendChild(ageLabel);
            ageGroup.appendChild(ageInput);

            const submitButton = document.createElement('button');
            submitButton.className = 'start-button';
            submitButton.innerText = '시작하기';
            submitButton.onclick = () => {
                nickname = nicknameInput.value.trim();
                gender = genderSelect.value;
                age = ageInput.value.trim();

                if (!nickname) {
                    alert('닉네임을 입력해주세요.');
                    return;
                }
                if (!gender) {
                    alert('성별을 선택해주세요.');
                    return;
                }
                if (!age || isNaN(age) || age <= 0) {
                    alert('유효한 나이를 입력해주세요.');
                    return;
                }

                stage = 1;
                displayCards();
                updateSelectionCount();
            };

            form.appendChild(nicknameGroup);
            form.appendChild(genderGroup);
            form.appendChild(ageGroup);
            form.appendChild(submitButton);

            cardContainer.appendChild(form);
        }

        function selectCard(cardName) {
            if (stage === 2 && usedImages.length < 8) {
                usedImages.push(cardName);
                document.getElementById('selected-card').innerText = `선택하신 카드: ${cardName}`;
                if (usedImages.length === 8) {
                    stage = 3;
                    displayedImages = [];
                }
            } else if (stage === 4 && finalSelection.length < 4) {
                finalSelection.push(cardName);
                document.getElementById('selected-card').innerText = `선택하신 카드: ${cardName}`;
                if (finalSelection.length === 4) {
                    stage = 5;
                }
            }
            displayedImages = displayedImages.filter(image => image !== cardName);
            displayCards();
        }

        function updateSelectionCount() {
            let message = '';
            if (stage === 2) {
                message = `1단계 - 선택한 카드: ${usedImages.length}/8`;
            } else if (stage === 4) {
                message = `2단계 - 선택한 카드: ${finalSelection.length}/4`;
            } else if (stage === 6) {
                message = `3단계 - 카드를 슬롯에 넣어주세요.`;
            } else if (stage === 7) {
                message = `4단계 - 선택한 카드를 클릭하여 뒷면을 확인하세요.`;
            } else {
                message = '';
            }
            document.getElementById('selection-count').innerText = message;
        }

        function displayDragAndDropSelection() {
            const cardContainer = document.getElementById('card-container');
            cardContainer.innerHTML = '';

            selectedSlots = [null, null];

            const slotsContainer = document.createElement('div');
            slotsContainer.className = 'slots-container';
            cardContainer.appendChild(slotsContainer);

            for (let i = 0; i < 2; i++) {
                const slot = document.createElement('div');
                slot.className = 'slot';
                slot.setAttribute('data-slot-index', i);

                slot.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                });
                slot.addEventListener('drop', onDropInSlot);

                slotsContainer.appendChild(slot);
            }

            const cardsContainer = document.createElement('div');
            cardsContainer.className = 'cards-container';
            cardContainer.appendChild(cardsContainer);

            finalSelection.forEach((image, index) => {
                const cardElement = createCardElement(`images/${image}.png`, `Final Card ${index + 1}`);
                cardElement.setAttribute('draggable', 'true');
                cardElement.setAttribute('data-name', image);

                cardElement.addEventListener('dragstart', onDragStart);

                cardsContainer.appendChild(cardElement);
            });
        }

        function onDragStart(e) {
            const cardName = e.currentTarget.getAttribute('data-name');
            e.dataTransfer.setData('text/plain', cardName);
            e.dataTransfer.effectAllowed = 'move';
        }

        function onDropInSlot(e) {
            e.preventDefault();
            const slot = e.currentTarget;
            const slotIndex = slot.getAttribute('data-slot-index');
            if (selectedSlots[slotIndex]) {
                return;
            }
            const cardName = e.dataTransfer.getData('text/plain');

            const cardElement = document.querySelector(`.card[data-name='${cardName}']`);

            if (cardElement) {
                cardElement.parentNode.removeChild(cardElement);
                slot.appendChild(cardElement);
                selectedSlots[slotIndex] = cardName;
                slot.classList.add('filled');

                if (selectedSlots.filter(Boolean).length === 2) {
                    stage = 7;
                    displayCards();
                }
            }
        }

        function displayFinalCards() {
            const cardContainer = document.getElementById('card-container');
            cardContainer.innerHTML = '';

            selectedSlots.forEach((image, index) => {
                const cardElement = createCardElement(`images/${image}.png`, `Selected Card ${index + 1}`);
                cardElement.setAttribute('data-name', image);

                // 현재 카드의 앞/뒷면 상태를 추적하기 위한 변수 추가
                let isFront = true;

                // 클릭 이벤트 추가
                cardElement.onclick = () => {
                    const imgElement = cardElement.querySelector('img');
                    if (isFront) {
                        // 앞면이면 뒷면으로 변경
                        const backImage = image.replace('1', '2');
                        imgElement.src = `images/${backImage}.png`;
                    } else {
                        // 뒷면이면 앞면으로 변경
                        imgElement.src = `images/${image}.png`;
                    }
                    // 상태 토글
                    isFront = !isFront;
                };

                cardContainer.appendChild(cardElement);
            });

            document.getElementById('selected-card').innerText = `${nickname}님의 강점 카드 결과입니다!`;
        }


        // 초기 로드 시 상태 업데이트
        updateSelectionCount();
        displayCards();
    </script>
</body>
</html>
